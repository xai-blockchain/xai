#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

export PYBUILD_NAME=xai-blockchain
export PYBUILD_DISABLE=test

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_install:
	dh_auto_install
	# Create directory structure
	install -d debian/xai-blockchain/var/lib/xai
	install -d debian/xai-blockchain/var/lib/xai/blockchain
	install -d debian/xai-blockchain/var/lib/xai/wallets
	install -d debian/xai-blockchain/var/lib/xai/state
	install -d debian/xai-blockchain/var/log/xai
	install -d debian/xai-blockchain/etc/xai
	# Install configuration files
	install -m 644 config/genesis.json debian/xai-blockchain/etc/xai/ || true
	# Install systemd service
	install -d debian/xai-blockchain/lib/systemd/system
	install -m 644 debian/xai-node.service debian/xai-blockchain/lib/systemd/system/

override_dh_installinit:
	dh_installinit --name=xai-node

override_dh_installsystemd:
	dh_installsystemd --name=xai-node

override_dh_fixperms:
	dh_fixperms
	# Ensure data directories are writable by xai user
	chmod 750 debian/xai-blockchain/var/lib/xai
	chmod 750 debian/xai-blockchain/var/log/xai
