---
# Advanced egress network policy for XAI namespace
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: xai-egress-policy
  namespace: xai
spec:
  podSelector: {}
  policyTypes:
    - Egress
  egress:
    # Allow DNS resolution to kube-system
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: kube-system
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53

    # Allow traffic to monitoring namespace (Prometheus scraping)
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090  # Prometheus
        - protocol: TCP
          port: 9093  # Alertmanager

    # Allow intra-namespace communication
    - to:
        - namespaceSelector:
            matchLabels:
              project: xai

    # Deny all other egress by default (implicit)

---
# Advanced egress network policy for Aura namespace
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: aura-egress-policy
  namespace: aura
spec:
  podSelector: {}
  policyTypes:
    - Egress
  egress:
    # Allow DNS resolution to kube-system
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: kube-system
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53

    # Allow traffic to monitoring namespace (Prometheus scraping)
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090  # Prometheus
        - protocol: TCP
          port: 9093  # Alertmanager

    # Allow intra-namespace communication
    - to:
        - namespaceSelector:
            matchLabels:
              project: aura

---
# Advanced egress network policy for PAW namespace
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: paw-egress-policy
  namespace: paw
spec:
  podSelector: {}
  policyTypes:
    - Egress
  egress:
    # Allow DNS resolution to kube-system
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: kube-system
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53

    # Allow traffic to monitoring namespace (Prometheus scraping)
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - protocol: TCP
          port: 9090  # Prometheus
        - protocol: TCP
          port: 9093  # Alertmanager

    # Allow intra-namespace communication
    - to:
        - namespaceSelector:
            matchLabels:
              project: paw
