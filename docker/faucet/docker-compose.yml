services:
  xai-faucet:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: xai-testnet-faucet
    ports:
      - "8086:8086"
    env_file:
      - .env
    environment:
      # XAI Node API URL (adjust to your node's address)
      XAI_API_URL: ${XAI_API_URL:-http://host.docker.internal:18545}
      XAI_FAUCET_PATH: ${XAI_FAUCET_PATH:-/faucet/claim}
      XAI_TRANSFER_PATH: ${XAI_TRANSFER_PATH:-/transfer}
      FAUCET_SENDER: ${FAUCET_SENDER:-}

      # Faucet web UI port
      FAUCET_PORT: ${FAUCET_PORT:-8086}

      # Amount to dispense per request (XAI)
      FAUCET_AMOUNT: ${FAUCET_AMOUNT:-200}

      # Max balance a wallet can have to be eligible
      FAUCET_MAX_BALANCE: ${FAUCET_MAX_BALANCE:-1000}

      # Cooldown period in seconds (default: 4 hours)
      FAUCET_COOLDOWN: ${FAUCET_COOLDOWN:-14400}

      # Environment / network safety
      FAUCET_ENV: ${FAUCET_ENV:-production}
      XAI_NETWORK: ${XAI_NETWORK:-testnet}
      FAUCET_ALLOW_MAINNET: ${FAUCET_ALLOW_MAINNET:-0}
      REQUIRE_CAPTCHA_IN_PROD: ${REQUIRE_CAPTCHA_IN_PROD:-1}

      # IP rate limiting (5 visits per 24hr)
      FAUCET_IP_COOLDOWN: ${FAUCET_IP_COOLDOWN:-600}
      FAUCET_IP_MAX_PER_WINDOW: ${FAUCET_IP_MAX_PER_WINDOW:-5}
      FAUCET_IP_WINDOW: ${FAUCET_IP_WINDOW:-86400}

      # Wallet daily visit limit (2 visits per 24hr)
      FAUCET_WALLET_MAX_PER_DAY: ${FAUCET_WALLET_MAX_PER_DAY:-2}

      # Global daily limit (40,000 XAI per 24hr, resets at midnight EST = 5 UTC)
      FAUCET_DAILY_LIMIT: ${FAUCET_DAILY_LIMIT:-40000}
      FAUCET_DAILY_RESET_HOUR_UTC: ${FAUCET_DAILY_RESET_HOUR_UTC:-5}

      # Address prefix validation
      FAUCET_ALLOWED_PREFIXES: ${FAUCET_ALLOWED_PREFIXES:-xaitest1}

      # Turnstile (captcha)
      TURNSTILE_SITE_KEY: ${TURNSTILE_SITE_KEY:-}
      TURNSTILE_SECRET_KEY: ${TURNSTILE_SECRET_KEY:-}
      FAUCET_REQUIRE_CAPTCHA: ${FAUCET_REQUIRE_CAPTCHA:-}

      # Redis (optional)
      REDIS_URL: ${REDIS_URL:-}

    networks:
      - xai-network

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8086/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    labels:
      com.xai.service: "faucet"
      com.xai.description: "XAI Testnet Faucet Web Interface"

networks:
  xai-network:
    name: xai-testnet
    external: true
